<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <title>Voice Tunes</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
        <link rel="stylesheet" href="styles.css">
        <!-- <script>
            // When calling getUserMedia() from HTTPS, users don't have to grant or deny access every time.
            if (location.protocol != 'https:')
              location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        </script> -->
        <!-- Includes Magenta models and js library -->
        <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.2"></script> 
        <!-- Script is executed when the page has finished parsing -->
        <script type="text/javascript" src="src/index.js" defer></script>
    </head>
    <body>
        <header>
            <h1>VOICE<br>TUNES</h1>
        </header>
        <main id = "mainContainer">

            <section id="about" hidden>
                <p>This app converts raw audio to MIDI using <a href="https://g.co/magenta/onsets-frames">Onsets and Frames</a>, a neural network trained for polyphonic 
                  piano transcription. Record yourself playing piano from your device to transcribe!</p>
                <p>Don't have a piano? Try singing to it to see what your voice sounds like played by a piano! Your voice isn't a piano though, so it
                might not sound like you at all ðŸ˜….</p>
                
                <p>All of the processing happens locally in the browser using <a href="https://g.co/magenta">Magenta.js</a> and 
                  <a href="https://js.tensorflow.org/">TensorFlow.js</a>.</p>

                <!-- <button class = "button next" id="nextBtn">Next</button> -->
            </section>

            <section id = "usernameContainer">
                <div id = "usernameDropdownContainer">
                </div>
                <div id = "usernameFormContainer">
                </div>
            </section>
            
            <section id = "recordingContainer">
                <div id= "modelLoading">
                    <span>Loading model...</span>
                </div>
                <div id= modelReady hidden>
                    <!-- Can we remove the below #buttons div (keep #btnRecord) -->
                    <div id = "buttons">
                        <button class="button" id="btnRecord" disabled>
                            <span class="text">Record</span>
                            <span class="loading">Transcribing...</span>
                        </button>
                    </div>
                    <div id="recordingError" hidden>Oh no, recording audio is not available on your device.</div>
                    <div id="iosError" hidden>Because of some WebAudio API issues, we can't get this model to work on your iOS device. We've tested it
                        on Android and desktop Chrome/Safari/FF, and it works there, so maybe grab a different device? We're really sorry. ðŸ˜°</div>
                </div>

                <div id="transcribingMessage" hidden>
                    Longer audio takes a fair bit to transcribe, and will make your browser sluggish. Please hold while 
                    your robots are hard at work...
                    
                    <div id="safariWarning" hidden><br><br>It looks like you're using Safari! Unfortunately because of a 
                      <a href="https://github.com/WebKit/webkit/blob/4a4870b75b95a836b516163d45a5cbd6f5222562/Source/WebCore/Modules/webaudio/AudioContext.cpp#L109">WebKit bug</a>, 
                    transcription is significantly slower on Safari than other browsers.
                    </div>
                </div>

                <div class="container" id="container" hidden>
                    <canvas id="canvas"></canvas>
                </div>
        
                <div class="icon" id="playIcon" hidden >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path xmlns="http://www.w3.org/2000/svg" d="M8 5v14l11-7z"/>
                      <path xmlns="http://www.w3.org/2000/svg" d="M0 0h24v24H0z" fill="none"/>
                    </svg>
                </div>
                <div class="icon" id="pauseIcon" hidden>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                      <path xmlns="http://www.w3.org/2000/svg" d="M0 0h24v24H0z" fill="none"/>
                      <path xmlns="http://www.w3.org/2000/svg" d="M6 6h12v12H6z"/>
                    </svg>
                </div>

                <button class="button save" onclick="saveMidiToComputer(event)" id="saveToCompBtn" hidden>SAVE TO COMPUTERz</button>
                <button class="button save" onclick="saveMidiToApp(event)" id="saveToAppBtn" hidden>SAVE TO APP</button>
                <button class="button cancel" onclick="cancelMidi(event)" id="cancelBtn" hidden>CANCEL</button>

            </section>

            <section id = "historyContainer">
            </sction>

        </main>

        <!-- Do not think ths is needed since you will not be creating polyfill
        <script>
            if (!window.MediaRecorder) {
               document.write(decodeURI('%3Cscript src="./polyfill.js">%3C/script>'))
            }
        </script> -->

        <!-- Allows user to download files -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js" defer></script>
    </body>
<html>